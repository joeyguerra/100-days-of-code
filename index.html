<!DOCTYPE html>
<html>
    <head>
        <title>100 Days of Code</title>
        <link href="main-layout.css" rel="stylesheet">
        <style>
            main section {
                display: flex;
                flex-flow: row wrap;
                align-items: stretch;
            }
            main section article {
                flex: auto;
                height: 400px;
                margin-right: 1em;
            }
            main section article h2 {
                margin: 0;
                padding: 0;
            }
            figure {
                height: 120px;
                margin: 0;
                padding: 0;
            }
        </style>
    </head>
    <body>
        <header>
            <h1>100 Days of Code</h1>
        </header>
        <nav>
            <h2>Site Nav</h2>
            <ul>
                <li>Home</li>
                <li>Time Tracker</li>
                <li>Web Shop</li>
                <li><a href="stufftodos.html" title="Stuff Todos">Stuff Todos</a></li>
            </ul>
            <input type="text" id="searchTermView" />
        </nav>
        <main>
            <section id="productListView">
                <article id="productView_globalUsing">
                    <h2>
                        <a href="https://www.bonfire.com/global-using-empathy-light-theme/?from=100daysofcode" title="Global Using Empthy - Light Theme">Global Using Empathy - Light Theme</a>
                    </h2>
                    <section>
                        <figure>
                            <img src="https://c.bonfireassets.com/thumb/design-image/835281b7-22ec-4806-94fd-929d6345cd8f/e4213c53-8052-4c44-ad64-9d06f2cda5e3/?size=150" title="Global Using Empathy - Light Theme" alt="Light t-shirt that says Global Using Empathy" />
                        </figure>
                    </section>
                    <footer>
                        <p>Proceeds benefit <a href="https://www.bonfire.com/org/black-girls-code-inc-454930539/">Black Girls Code Inc.</a></p>
                        <form id="formView_gloablUsingEmpathy" action="https://www.bonfire.com/global-using-empathy-light-theme/?from=100daysofcode">
                            <button type="submit" form="formView_gloablUsingEmpathy">Buy</button>
                        </form>
                    </footer>
                </article>
                <article id="productView_dotNetRun">
                    <h2>
                        <a href="https://www.bonfire.com/dot-net-run/?from=100daysofcode" title="Dot Net Run">Dot Net Run</a>
                    </h2>
                    <section>
                        <figure>
                            <img src="https://c.bonfireassets.com/thumb/design-image/a7142aa8-ce2a-4916-8914-89261e6325b2/7329f207-b69c-4f7e-8322-9f628fd81358/?size=150" title="Dot Net Run" alt="Black t-shirt that says Dot Net Run" />
                        </figure>
                    </section>
                    <footer>
                        <p>Proceeds benefit <a href="https://www.bonfire.com/org/black-girls-code-inc-454930539/">Black Girls Code Inc.</a></p>
                        <form id="formView_dotNetRun" action="https://www.bonfire.com/dot-net-run/?from=100daysofcode">
                            <button type="submit" form="formView_dotNetRun">Buy</button>
                        </form>
                    </footer>
                </article>
                <article id="productView_mauiMug">
                    <h2>
                        <a href="https://www.bonfire.com/net-maui-mug/?from=100daysofcode" title=".NET MAUI Mug">.NET MAUI Mug</a>
                    </h2>
                    <section>
                        <figure>
                            <img src="https://c.bonfireassets.com/thumb/design-image/4113640f-a316-40e1-a8b8-895d1b3deb65/83e306df-dddb-47a7-94ba-6a82487b39ab/?size=150" title=".NET MAUI Mug" alt="Mug that says .NET MAUI Mug" />
                        <figure>
                    </section>
                    <footer>
                        <p>Proceeds benefit <a href="https://www.bonfire.com/org/black-girls-code-inc-454930539/">Black Girls Code Inc.</a></p>
                        <form id="formView_mauiMug" action="https://www.bonfire.com/net-maui-mug/?from=100daysofcode">
                            <button type="submit" form="formView_mauiMug">Buy</button>
                        </form>
                    </footer>
                </article>
                <article id="productView_mauiShirtDarkMode">
                    <h2>
                        <a href="https://www.bonfire.com/dotnet-maui-dark/?from=100daysofcode" title=".NET MAUI Shirt Dark Mode">.NET MAUI Shirt Dark Mode</a>
                    </h2>
                    <section>
                        <figure>
                            <img src="https://c.bonfireassets.com/thumb/design-image/33d46142-6edb-42ab-9a98-8f629f795e12/a12f1364-34a5-4ab3-bcd5-fb45910a2e8f/?size=150" title=".NET MAUI Shirt Dark Mode" alt="Black T-Shirt that says using Microsoft.Maui;" />
                        </figure>
                    </section>
                    <footer>
                        <p>Proceeds benefit <a href="https://www.bonfire.com/org/black-girls-code-inc-454930539/">Black Girls Code Inc.</a></p>
                        <form id="formView_mauiShirtDarkMode" action="https://www.bonfire.com/dotnet-maui-dark/?from=100daysofcode">
                            <button type="submit" form="formView_mauiShirtDarkMode">Buy</button>
                        </form>
                    </footer>
                </article>
                <article id="productView_button2020DjEqShirt">
                    <h2>
                        <a href="https://www.bonfire.com/button-2020-dj-eq-shirt/" title="Button 2020 DJ EQ Shirt">Button 2020 DJ EQ Shirt</a>
                    </h2>
                    <section>
                        <figure>
                            <img src="https://c.bonfireassets.com/thumb/design-image/bcf8f4c9-d4bb-4534-a4b8-61e64bbd28e7/356b92fe-d24f-4563-a83c-148f2b248756/?size=150" title="Button 2020 DJ EQ Shirt" alt="Dark colored T-Shirt with a histogram chart made up from different colored circles" />
                        </figure>
                    </section>
                    <footer>
                        <p>Proceeds benefit <a href="https://www.bonfire.com/org/black-girls-code-inc-454930539/">Black Girls Code Inc.</a></p>
                        <form id="formView_button2020DjEqShirt" action="https://www.bonfire.com/button-2020-dj-eq-shirt/">
                            <button type="submit" form="formView_button2020DjEqShirt">Buy</button>
                        </form>
                    </footer>
                </article>
                <article id="productView_confab2015">
                    <h2>
                        <a href="https://www.bonfire.com/confab-2015/" title="Confab 2015">Confab 2015</a>
                    </h2>
                    <section>
                        <figure>
                            <img src="https://c.bonfireassets.com/thumb/design-image/5eb8148f-d0cc-4a82-9af6-c5ccaa7041c6/a12f1364-34a5-4ab3-bcd5-fb45910a2e8f/?size=150" title="Confab 2015" alt="Black T-Shirt with a cartoon rocket in the middle of a circle, says mission critical across the front" />
                        </figure>
                    </section>
                    <footer>
                        <p>Proceeds benefit <a href="https://www.bonfire.com/org/black-girls-code-inc-454930539/">Black Girls Code Inc.</a></p>
                        <form id="formView_confab2015" action="https://www.bonfire.com/confab-2015/">
                            <button type="submit" form="formView_confab2015">Buy</button>
                        </form>
                    </footer>
                </article>
                <article id="productView_heyFriends">
                    <h2>
                        <a href="https://www.bonfire.com/hey-friends/" title="Hey Friends!">Hey Friends!</a>
                    </h2>
                    <section>
                        <figure>
                            <img src="https://c.bonfireassets.com/thumb/design-image/1f8452cb-aae9-4ea9-91e3-d07aa0b4b48c/1bec9fd2-251a-42ed-89d6-2433030918a3/?size=150" title="Hey Friends!" alt="Pink T-Shirt with a 2 cartoonish people facing each other, smiling, with the left person handing the other a heart" />
                        </figure>
                    </section>
                    <footer>
                        <p>Proceeds benefit <a href="https://www.bonfire.com/org/black-girls-code-inc-454930539/">Black Girls Code Inc.</a></p>
                        <form id="formView_heyFriends" action="https://www.bonfire.com/hey-friends/">
                            <button type="submit" form="formView_heyFriends">Buy</button>
                        </form>
                    </footer>
                </article>
            </section>
        </main>
        <footer>
        </footer>
    </body>
    <script>
        class KeyValueObservable {
            constructor(observable = {}){
                this.dependents = {};
                observable = observable || {};
                const changed = this.changed.bind(this);
                const cached = Object.assign({}, observable);
                Object.keys(observable).forEach(key => {
                    Reflect.defineProperty(this, key, {
                        get(){
                            return cached[key];
                        },
                        set(value){
                            const old = cached[key];
                            cached[key] = value;
                            changed(key, old, value);
                        }
                    })
                })
            }
            changed(key, old, value){
                if(!this.dependents[key]) return;
                this.dependents[key]?.forEach(o=>o.update(key, old, value));
            }
            observe(key, dependent){
                if(!this.dependents[key]) this.dependents[key] = [];
                this.dependents[key].push(dependent);
            }
            commit(){

            }
        }

        class ObservableLog extends Array{
            constructor(...args) {
                super(...args);
                this.observable = new KeyValueObservable(null);
            }
            append(item){
                super.push(item);
                this.observable.changed("append", null, item);
            }
            observe(key, observer){
                this.observable.observe(key, observer);
            }
        }
        class ObservableList extends Array{
            constructor(...args) {
                super(...args);
                this.observable = new KeyValueObservable(null);
            }
            push(item){
                super.push(item);
                this.observable.changed("push", null, item);
            }
            pop(){
                const item = super.pop();
                this.observable.changed("pop", null, item);
                return item;
            }
            remove(d){
                let i = 0;
                let ubounds = this.length;
                let deleted = [];
                for(i; i<ubounds;i++){
                    if(d(this[i], i)){
                        deleted = this.splice(i, 1);
                        this.delegate.changed("remove", deleted[0], i);
                        break;
                    }
                }
                return deleted[0];
            }
            observe(key, observer){
                this.observable.observe(key, observer);
            }
        }

        class ButtonView {
            constructor(container, model, delegate){
                this.container = container;
                this.model = model;
                this.delegate = delegate;
            }
        }
        let timer = null;
        const debounce = (fn, timeout)=>{
            clearTimeout(timer);
            timer = setTimeout(fn, timeout);
        };
        class ProductListView {
            constructor(container, model, delegate){
                this.container = container;
                this.model = model;
                this.delegate = delegate;
                this.template = this.container.querySelector("article").cloneNode(true);
                this.model.displayedProducts.observe("push", this);
                this.model.displayedProducts.observe("remove", this);
                this.model.observe("searchTerm", this);
            }
            update(key, old, value){
                this.container.innerHTML = "";
                if(key == "searchTerm"){
                    debounce(function(){
                        const found = this.model.products.filter(product=>product.title.toLowerCase().indexOf(value.toLowerCase()) > -1);
                        this.add(found);
                    }.bind(this), 100);
                }
            }
            add(products){
                if(products == null || products.length == 0) return;
                const nodes = products.map(p => {
                    let elem = this.template.cloneNode(true);
                    elem.querySelector("h2 a").innerText = p.title;
                    elem.querySelector("h2 a").href = p.href;
                    elem.querySelector("img").src = p.src;
                    elem.querySelector("form").action = p.href;
                    return elem;
                });
                nodes.forEach(n=>this.container.appendChild(n));
            }
        }
        class SearchTermView {
            constructor(container, model, delegate){
                this.container = container;
                this.model = model;
                this.delegate = delegate;
                this.container.addEventListener("keyup", this, true);
            }
            handleEvent(e){
                this.model.searchTerm = e.target.value;
            }
        }
        
        const model = new KeyValueObservable({
            searchTerm: "",
            products: [...document.getElementById("productListView").querySelectorAll("article")].map(article => {
                return {
                    title: article.querySelector("h2 a").title,
                    href: article.querySelector("h2 a").href,
                    src: article.querySelector("img").src
                }
            }),
            displayedProducts: new ObservableList()
        });
        const app = {
            views: new ObservableList(),
            events: new ObservableLog()
        };

        app.views.push(new SearchTermView(document.getElementById("searchTermView"), model, app));
        app.views.push(new ProductListView(document.getElementById("productListView"), model, app));
    </script>
</html>